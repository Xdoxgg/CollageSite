<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Моя страница</title>

    <link rel="stylesheet" href="/Styles/index.css">
    <link rel="stylesheet" href="/Styles/main.css">

</head>
<body>
<header class="top-panel">
    <nav class="nav-menu">
        <ul>
            <li><a href="#">Главная</a></li>
            <li><a href="#">Абитуриентам<span class="arrow">▼</span></a>
                <ul class="submenu">
                    <li><a href="#">Расписание</a></li>

                    <li><a href="#">Оценки</a></li>
                </ul>
            </li>

            <li><a href="#">Контакты</a></li>
            <li><a href="../Pages/autorisation.html">Аккаунт</a></li>

        </ul>

    </nav>
    <div class="user-card">
        <div class="user-card-group" id="userCardGroup"></div>
        <div class="user-card-name">
            <div class="user-card-name-text" id="userCardName"></div>
        </div>
    </div>
</header>


<div style="display: flex; justify-content: center; margin-top: 200px;">
    <table class="content" id="content" style="border: white solid 1px;">
    </table>
</div>

<script src="../Scripts/mainScripts.js"></script>
<script src="/Scripts/mainScripts.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', main);

    async function main() {
        await setUserCard()
        await setNews()
    }

    async function setNews() {
        try {
            const response = await fetch('/api/news')
            if (!response.ok) {
                throw new Error('Ошибка запроса: ' + response.statusText);
            }

            const data = await response.json();
            loadNews(data)
        } catch (ex) {
            alert(ex)
        }
    }

    function loadNews(news) {
        const table = document.getElementById('content');

        for (let i = 0; i < news.length; i++) {
            let row = document.createElement('tr');
            let col = document.createElement('td');
            col.className = 'news';
            col.style.display = 'flex';
            col.style.alignItems = 'center';
            col.style.padding = '10px';

            // Создаем контейнер для изображения и текста
            const img = document.createElement('img');
            img.src = 'Images/' + news[i].img + '.png'; // Предполагается, что у вас есть поле image в объекте новости
            img.alt = "Изображение новости";
            img.className = 'news'; // Применяем класс для стилей
       
            // Создаем контейнер для заголовка и описания
            const textContainer = document.createElement('div');

            // Добавляем заголовок
            const title = document.createElement('h3');
            title.textContent = news[i].title; // Предполагается, что у вас есть поле title в объекте новости
            textContainer.appendChild(title);

            // Добавляем описание
            const description = document.createElement('p');
            description.textContent = news[i].data; // Предполагается, что у вас есть поле description в объекте новости
            textContainer.appendChild(description);

            // Добавляем изображение и текстовый контейнер в ячейку
            col.appendChild(img);
            col.appendChild(textContainer);
            row.appendChild(col);
            table.appendChild(row);
        }
    }
    async function setUserData() {

        let user = await getItemFromLocalStorage('user');
        try {
            user = JSON.parse(user)

        } catch (ex) {
            alert(ex)
        }
        try {

            const response = await fetch('/api/student_data?s_name=' + encodeURIComponent(user.uName) + '&s_password=' + encodeURIComponent(user.uDate), {
                method: 'GET',
            });
            if (!response.ok) {
                throw new Error('Ошибка запроса: ' + response.statusText);
            }


            const data = await response.json();

            setUserCardGroup(data)
            setUserCardName(user.uName)
            return JSON.stringify(data, null, 2);
        } catch (error) {
            console.error('Ошибка:', error);
            alert('Ошибка: ' + error.message);
        }
    }

    function setUserCardGroup(text) {
        document.getElementById('userCardGroup').textContent = text;
    }

    function setUserCardName(text) {
        document.getElementById('userCardName').textContent = text;

    }

    function setUserCard() {
        if (localStorage.getItem('user') != null) {
            setUserData()
        }
    }

</script>


</body>
</html> 